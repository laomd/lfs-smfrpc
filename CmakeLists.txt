cmake_minimum_required(VERSION 3.11)
project(lao_hdfs VERSION 0.1)

list(APPEND CMAKE_MODULE_PATH ${CMAKE_CURRENT_LIST_DIR}/cmake)
set(CMAKE_CXX_STANDARD 17)
set(ENV{PKG_CONFIG_PATH} "$PKG_CONFIG_PATH:/usr/lib64/pkgconfig:/usr/local/lib64/pkgconfig:/usr/local/lib/pkgconfig")

find_package(PkgConfig REQUIRED)
find_package(Protobuf REQUIRED)
find_package(Glog REQUIRED)
pkg_search_module(SEASTAR REQUIRED seastar)
pkg_search_module(SEASTAR_TEST REQUIRED seastar-testing)
pkg_search_module(GRPC REQUIRED grpc)

add_definitions(-DBOOST_TEST_DYN_LINK)

include_directories(${PROJECT_SOURCE_DIR})
include_directories(${CMAKE_BINARY_DIR})
include_directories(${SEASTAR_STATIC_INCLUDE_DIRS})
include_directories(${GRPC_STATIC_INCLUDE_DIRS})
include_directories(${PROTOBUF_INCLUDE_DIRS})
include_directories(BEFORE ${GLOG_INCLUDE_DIRS})

link_directories(${GRPC_STATIC_LIBRARY_DIRS})
link_libraries(${SEASTAR_STATIC_LDFLAGS})
link_libraries(${SEASTAR_TEST_STATIC_LDFLAGS})
set(RPC_LIBS grpc++)
link_libraries(${PROTOBUF_LIBRARIES})
link_libraries(glog gflags)
add_compile_options(
    ${SEASTAR_STATIC_CFLAGS_OTHER}
    ${SEASTAR_TEST_STATIC_CFLAGS_OTHER}
    -Wall -Werror -Wreorder
)

include(utils.cmake)

enable_testing()
# add_subdirectory(lao_paxos)
# add_subdirectory(echo_service)
# add_subdirectory(coroutine)
# add_subdirectory(mvcc)
add_subdirectory(unit)